{"version":3,"sources":["Input.ts"],"names":[],"mappings":"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","file":"Input.js","sourcesContent":["\r\nnamespace deltav {\r\n\r\n    export interface IInput {\r\n        lastClick: MouseEvent;\r\n        isDown(key: CtlKey): boolean;\r\n        rate(key: CtlKey): number;\r\n    }\r\n\r\n    export enum CtlKey {\r\n        Up = 104,\r\n        Down = 98,\r\n        Left = 100,\r\n        Right = 102,\r\n        Accelerate = 38,\r\n        Brake = 40,\r\n        Clockwise = 39,\r\n        AntiClockwise = 37,\r\n        FirePrimary = 17,\r\n        FireSecondary = 32,\r\n    }\r\n    /*\r\n     * http://www.cambiaresearch.com/articles/15/javascript-key-codes\r\n     */\r\n    export class Input implements IInput {\r\n        public lastClick: MouseEvent;\r\n        private pressed = new Array<boolean>();\r\n        // private gamepad: Gamepad = null;\r\n        \r\n        constructor(canvas: HTMLCanvasElement, doc: HTMLDocument) {\r\n            canvas.addEventListener(\"click\", ev => this.click(ev));\r\n            canvas.addEventListener(\"mousewheel\", ev => this.wheel(ev));\r\n            doc.addEventListener(\"keydown\", ev => this.keyDown(ev));\r\n            doc.addEventListener(\"keyup\", ev => this.keyUp(ev));\r\n            \r\n            window.addEventListener(\"gamepadconnected\", ev => this.gamePadOn(<GamepadEvent>ev));\r\n            window.addEventListener(\"gamepaddisconnected\", ev => this.gamePadOff(<GamepadEvent>ev));\r\n        }\r\n\r\n        public isDown(key: CtlKey): boolean {\r\n            let gamepad = navigator.getGamepads()[0];\r\n            \r\n            if (gamepad == null) {\r\n                return this.pressed[key];\r\n            } else {\r\n                return this.gamepadIsKeyDown(gamepad, key);\r\n            }\r\n        }\r\n\r\n        public rate(key: CtlKey): number {\r\n            let gamepad = navigator.getGamepads()[0];\r\n            \r\n            if (gamepad == null) {\r\n                return 1;\r\n            } else {\r\n                return this.gamepadRate(gamepad, key);\r\n            }\r\n        }\r\n\r\n        private gamepadRate(gamepad: Gamepad, key: CtlKey): number {\r\n            switch (key) {\r\n                case CtlKey.Accelerate: return -Math.min(gamepad.axes[1], 0);\r\n                case CtlKey.Brake: return Math.max(gamepad.axes[1], 0);\r\n                case CtlKey.AntiClockwise: return -Math.min(gamepad.axes[0], 0);\r\n                case CtlKey.Clockwise: return Math.max(gamepad.axes[0], 0);\r\n            }\r\n        }\r\n\r\n        private gamepadIsKeyDown(gamepad: Gamepad, key: CtlKey): boolean {\r\n            switch (key) {\r\n                case CtlKey.FirePrimary: return gamepad.buttons[0].pressed;\r\n                case CtlKey.FireSecondary: return gamepad.buttons[1].pressed;\r\n                case CtlKey.Accelerate: return this.gamepadRate(gamepad, key) > 0.1;\r\n                case CtlKey.Brake: return this.gamepadRate(gamepad, key) > 0.1;\r\n                case CtlKey.AntiClockwise: return this.gamepadRate(gamepad, key) > 0.2;\r\n                case CtlKey.Clockwise: return this.gamepadRate(gamepad, key) > 0.2;\r\n            }\r\n        }\r\n\r\n        private gamePadOn(ev: GamepadEvent) {\r\n            console.log(\"Gamepad connected at index %d: %s. %d buttons, %d axes.\",\r\n                ev.gamepad.index, ev.gamepad.id,\r\n                ev.gamepad.buttons.length, ev.gamepad.axes.length);\r\n        } \r\n\r\n        private gamePadOff(ev: GamepadEvent) {\r\n            console.log(\"Gamepad disconnected from index %d: %s\",\r\n                ev.gamepad.index, ev.gamepad.id);\r\n        }\r\n\r\n        private keyUp(ev: KeyboardEvent) {\r\n            this.pressed[ev.keyCode] = false;\r\n        }\r\n\r\n        private keyDown(ev: KeyboardEvent) {\r\n            this.pressed[ev.keyCode] = true;\r\n        }\r\n\r\n        private wheel(ev: MouseWheelEvent) {\r\n            // nothing\r\n        }\r\n\r\n        private click(ev: MouseEvent) {\r\n            this.lastClick = ev;\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}