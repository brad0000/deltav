{"version":3,"sources":["Ship.ts"],"names":[],"mappings":"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","file":"Ship.js","sourcesContent":["namespace deltav {\r\n    export class Ship extends Body {\r\n\r\n        private power = 5000;\r\n        private angularPower = 2000;\r\n        private weapon: Weapon;\r\n\r\n        constructor(logger: Logger, x: number, y: number) {\r\n            super(logger, x, y);\r\n\r\n            this.weapon = new Weapon(this);\r\n            this.brush = \"red\";\r\n\r\n            this.velocity = Vector.create([0, 1]);\r\n\r\n            this.geometry = [\r\n                Vector.create([-2, -3]), // back of wing\r\n                Vector.create([0, -3]),\r\n                Vector.create([1, -1]),\r\n                Vector.create([4, -.8]), // top right nose\r\n                Vector.create([4, .8]),\r\n                Vector.create([1, 1]),\r\n                Vector.create([0, 3]),\r\n                Vector.create([-2, 3]), // back of wing\r\n                Vector.create([-1.5, 1]),\r\n                Vector.create([-2, 1]),\r\n                Vector.create([-2, -1]),\r\n                Vector.create([-1.5, -1]),\r\n            ];\r\n\r\n            for (let i = 0; i < this.geometry.length; i++) {\r\n                this.geometry[i] = this.geometry[i].multiply(5);\r\n            }\r\n        }\r\n\r\n        public update(time: number, world: World, input: Input) {\r\n            super.update(time, world, input);\r\n\r\n            this.heading = this.velocity.toAngle();\r\n\r\n            this.weapon.update(time);\r\n            if (input.isDown(CtlKey.Fire) && this.weapon.ready()) {\r\n                this.weapon.fire(world, this.position, this.velocity, this.mass);\r\n            }\r\n\r\n            // calc net forces\r\n            let force = Vector.Zero(2);\r\n            if (input.isDown(CtlKey.Up)) {\r\n                force = force.add(Vector.create([0, -this.power]));\r\n            } else if (input.isDown(CtlKey.Down)) {\r\n                force = force.add(Vector.create([0, this.power]));\r\n            }\r\n            if (input.isDown(CtlKey.Left)) {\r\n                force = force.add(Vector.create([-this.power, 0]));\r\n            } else if (input.isDown(CtlKey.Right)) {\r\n                force = force.add(Vector.create([this.power, 0]));\r\n            }\r\n            if (input.isDown(CtlKey.Accelerate)) {\r\n                if (this.velocity.eql(Vector.Zero(2))) {\r\n                    // Allow user to accelerate from standing stop.\r\n                    this.velocity.setElements([0, -0.1]);\r\n                }\r\n                force = force.add(this.velocity.toUnitVector().multiply(this.power));\r\n            } else if (input.isDown(CtlKey.Brake)) {\r\n                force = force.add(this.velocity.rotate(Math.PI, Vector.Zero(2)).toUnitVector().multiply(this.power));\r\n            }\r\n            this.acceleration = force.divide(this.mass).multiply(time);\r\n\r\n            // change heading\r\n            let veerRight = input.isDown(CtlKey.Clockwise);\r\n            let veerLeft = input.isDown(CtlKey.AntiClockwise);\r\n            let rotation: Vector = null;\r\n            if (veerRight || veerLeft) {\r\n                rotation = this.velocity\r\n                    .rotate(Math.PI / 2 * (veerRight ? 1 : -1), Vector.Zero(2))\r\n                    .toUnitVector()\r\n                    .multiply(this.angularPower)\r\n                    .multiply(time);\r\n                this.acceleration = this.acceleration.add(rotation);\r\n            }\r\n        }\r\n\r\n        public report(): string {\r\n            return \"p \" + this.fv(this.position, 0)\r\n                + \" h \" + this.fh(this.velocity.toAngle())\r\n                + \" v \" + this.velocity.modulus().toFixed(2)\r\n                + \" a \" + this.acceleration.modulus().toFixed(2);\r\n        }\r\n\r\n        public render(ctx: CanvasRenderingContext2D) {\r\n            super.render(ctx);\r\n\r\n            if  (this.velocity.modulus() > 0.5) {\r\n                ctx.beginPath();\r\n                ctx.strokeStyle = \"red\";\r\n                ctx.moveTo(this.getX(), this.getY());\r\n                let endOfLine = this.position.add(this.velocity.toUnitVector().multiply(this.mass * 2));\r\n                ctx.lineTo(endOfLine.e(1), endOfLine.e(2));\r\n                ctx.stroke();\r\n            }\r\n\r\n            ctx.beginPath();\r\n            ctx.fillStyle = \"white\";\r\n            ctx.font = \"20px Arial\";\r\n            ctx.fillText(this.report(), 20, 40);\r\n            ctx.fill();\r\n        }\r\n\r\n        private fh(rad: number): string {\r\n            let deg = rad * 180 / Math.PI;\r\n            return deg.toFixed(0);\r\n        }\r\n\r\n        private fv(v: Vector, dp: number): string {\r\n            let e = v.elements;\r\n            return e[0].toFixed(dp) + \", \" + e[1].toFixed(dp);\r\n        }\r\n    }\r\n\r\n    export class Weapon {\r\n        private velocity = 100;\r\n        private reloadTime = .5;\r\n        private countdown = 0;\r\n\r\n        constructor(private ship: Ship) {\r\n        }\r\n\r\n        public ready() {\r\n            return this.countdown === 0;\r\n        }\r\n\r\n        public update(time: number) {\r\n            this.countdown -= time;\r\n            if (this.countdown < 0) {\r\n                this.countdown = 0;\r\n            }\r\n        }\r\n\r\n        public fire(world: World, position: Vector, velocity: Vector, mass: number) {\r\n            let barrel = position; // .add(Vector.create([4, 0]).multiply(5).rotate(this.ship.getH(), position));\r\n            let shipV = this.ship.getV();\r\n            world.bodies.push(\r\n                new Bullet(\r\n                    this.ship,\r\n                    barrel.e(1),\r\n                    barrel.e(2),\r\n                    shipV.add(shipV.toUnitVector().multiply(this.velocity))));\r\n            this.countdown = this.reloadTime;\r\n        }\r\n    }\r\n\r\n    export class Bullet extends Body {\r\n        constructor(ship: Ship, x: number, y: number, velocity: Vector) {\r\n            super(ship.logger, x, y);\r\n            this.velocity = velocity;\r\n            this.mass = 2;\r\n            this.brush = \"orange\";\r\n            this.heading = ship.getH();\r\n\r\n            this.geometry.push(Vector.create([-5, -2.5]));\r\n            this.geometry.push(Vector.create([4, -2.5]));\r\n            this.geometry.push(Vector.create([6.25, 0]));\r\n            this.geometry.push(Vector.create([4, 2.5]));\r\n            this.geometry.push(Vector.create([-5, 2.5]));\r\n        }\r\n\r\n        public update(time: number, world: World, input: Input) {\r\n            super.update(time, world, input);\r\n        }\r\n\r\n        public render(ctx: CanvasRenderingContext2D) {\r\n            super.render(ctx);\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}