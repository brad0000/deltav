{"version":3,"sources":["Weapon.ts"],"names":[],"mappings":"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","file":"Weapon.js","sourcesContent":["namespace deltav {\r\n    export class Weapon {\r\n        protected logger: Logger;\r\n        private countdown = 0;\r\n\r\n        constructor(\r\n            protected ship: Ship, \r\n            protected position: Vector,\r\n            public caliber: number, \r\n            private velocity: number, \r\n            private reloadTime: number) {\r\n            this.logger = ship.logger;\r\n        }\r\n\r\n        public ready() {\r\n            return this.countdown === 0;\r\n        }\r\n\r\n        public update(time: number) {\r\n            this.countdown -= time;\r\n            if (this.countdown < 0) {\r\n                this.countdown = 0;\r\n            }\r\n        }\r\n\r\n        public fire(world: World) {\r\n            let shipP = this.ship.getP();\r\n            let shipV = this.ship.getV();\r\n            \r\n            let muzzle = shipP.add(this.position).rotate(this.ship.getH(), shipP);\r\n            let bulletV = shipV.add(shipV.toUnitVector().multiply(this.velocity));\r\n            \r\n            world.addDynamicBody(this.makeBullet(muzzle, bulletV));\r\n            this.countdown = this.reloadTime;\r\n        }\r\n\r\n        protected makeBullet(muzzle: Vector, velocity: Vector): Bullet {\r\n            // nothing\r\n            return null;\r\n        }\r\n\r\n        public recentlyFired(bullet: Bullet): boolean {\r\n            return bullet.isFrom(this) && this.countdown > 0;\r\n        }\r\n    }\r\n\r\n    export class GattlingGun extends Weapon {\r\n        constructor(ship: Ship, position: Vector) {\r\n            super(ship, position, 1, 400, 0.2);\r\n        }\r\n\r\n        public makeBullet(muzzle: Vector, velocity: Vector) {\r\n            let geo = [\r\n                Vector.create([-10, -0.75]),\r\n                Vector.create([10, -0.75]),\r\n                Vector.create([10, 0.75]),\r\n                Vector.create([-10, 0.75]),\r\n            ];\r\n\r\n            return new Bullet(\r\n                this.logger,\r\n                this,\r\n                muzzle,\r\n                velocity,\r\n                \"OrangeRed\",\r\n                geo);\r\n        }\r\n\r\n        public fire(world: World) {\r\n            super.fire(world);\r\n        }\r\n    }\r\n\r\n    export class Canon extends Weapon {\r\n        constructor(ship: Ship, position: Vector) {\r\n            super(ship, position, 10, 200, 1);\r\n        }\r\n\r\n        public makeBullet(muzzle: Vector, velocity: Vector) {\r\n\r\n            let geo = new Array<Vector>();\r\n            for (let i = 0; i < 10; i++) {\r\n                geo.push(\r\n                    Vector.create([1, 0])\r\n                        .rotate(Math.PI * 2 / 5 * i, Vector.Zero(2))\r\n                        .multiply(5));\r\n            }\r\n\r\n            return new Bullet(\r\n                this.logger,\r\n                this,\r\n                muzzle,\r\n                velocity,\r\n                \"#444461\",\r\n                geo);\r\n        }\r\n\r\n        public fire(world: World) {\r\n            super.fire(world);\r\n        }\r\n    }\r\n\r\n    export class Bullet extends Body {\r\n        constructor(\r\n            logger: Logger,\r\n            private weapon: Weapon,\r\n            position: Vector,\r\n            velocity: Vector,\r\n            color: string,\r\n            geometry: Array<Vector>) {\r\n\r\n            super(logger, position);\r\n            this.velocity = velocity;\r\n            this.mass = weapon.caliber;\r\n            this.brush = color;\r\n            this.heading = velocity.toAngle();\r\n\r\n            this.setGeometry(geometry);\r\n        }\r\n\r\n        public update(time: number, world: World, input: Input) {\r\n            return super.update(time, world, input);\r\n        }\r\n\r\n        public render(ctx: CanvasRenderingContext2D) {\r\n            super.render(ctx);\r\n        }\r\n\r\n        public isFrom(weapon: Weapon) {\r\n            return this.weapon === weapon;\r\n        }\r\n    }\r\n    \r\n    export class WeaponGroup {\r\n        constructor(private logger: Logger, private ship: Ship, private weapons: Weapon[]) {\r\n            // nothing\r\n        }\r\n\r\n        public ready(): boolean {\r\n            for (let i = 0; i < this.weapons.length; i++) {\r\n                if (!this.weapons[i].ready()) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n\r\n        public update(time: number) {\r\n            for (let i = 0; i < this.weapons.length; i++) {\r\n                this.weapons[i].update(time);\r\n            }\r\n        }\r\n\r\n        public fire(world: World, position: Vector, velocity: Vector) {\r\n            for (let i = 0; i < this.weapons.length; i++) {\r\n                this.weapons[i].fire(world);\r\n            }\r\n        }\r\n        \r\n        public recentlyFired(bullet: Bullet): boolean {\r\n            for (let i = 0; i < this.weapons.length; i++) {\r\n                if (this.weapons[i].recentlyFired(bullet)) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}