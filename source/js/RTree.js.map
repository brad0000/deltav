{"version":3,"sources":["RTree.ts"],"names":[],"mappings":"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","file":"RTree.js","sourcesContent":["namespace deltav {\r\n\r\n    export class RTree {\r\n\r\n        private root: RTreeNode;\r\n\r\n        constructor(world: World) {\r\n            \r\n            let iBoxes: Box[], jBoxes: Box[], kBoxes: Box[], lBoxes: Box[], mBoxes: Box[];\r\n            let iNode: RTreeNode, jNode: RTreeNode, kNode: RTreeNode, lNode: RTreeNode, mNode: RTreeNode;\r\n            \r\n            this.root = new RTreeNode(world, false);\r\n\r\n            iBoxes = world.divide();\r\n            for (let i = 0; i < iBoxes.length; i++) {\r\n                iNode = new RTreeNode(iBoxes[i], false);\r\n                \r\n                jBoxes = iBoxes[i].divide();\r\n                for (let j = 0; j < 4; j++) {\r\n                    jNode = new RTreeNode(jBoxes[j], false);\r\n\r\n                    kBoxes = jBoxes[j].divide();\r\n                    for (let k = 0; k < 4; k++) {\r\n                        kNode = new RTreeNode(kBoxes[k], false);\r\n                        \r\n                        lBoxes = kBoxes[k].divide();\r\n                        for (let l = 0; l < 4; l++) {\r\n                            lNode = new RTreeNode(lBoxes[l], false);\r\n\r\n                            mBoxes = lBoxes[l].divide();\r\n                            for (let m = 0; m < 4; m++) {\r\n                                mNode = new RTreeNode(mBoxes[m], false);\r\n                                lNode.children.push(mNode);\r\n                            }                        \r\n                            \r\n                            kNode.children.push(lNode);\r\n                        }\r\n                        \r\n                        jNode.children.push(kNode);    \r\n                    }                \r\n                    \r\n                    iNode.children.push(jNode);\r\n                }\r\n                \r\n                this.root.children.push(iNode);        \r\n            }\r\n        }\r\n\r\n        public add(body: Body): RTreeNode {\r\n            return this.root.add(body);\r\n        }\r\n        \r\n        public search(box: Box): Body[] {\r\n            let hits = new Array<Body>();\r\n            \r\n            this.root.search(box, hits);\r\n            \r\n            return hits;\r\n        }\r\n    }\r\n\r\n    export class RTreeNode {\r\n        public children = new Array<RTreeNode>();\r\n        public body: Body;\r\n        \r\n        constructor(public box: Box, public isLeaf: boolean) {\r\n            // nothing\r\n        }\r\n        \r\n        public search(searchArea: Box, hits: Array<Body>) {\r\n            if (this.isLeaf) {\r\n                if (searchArea.intersects(this.body.getBoundingBox())) {\r\n                    hits.push(this.body);\r\n                }\r\n            } else {\r\n                // Searching a branch            \r\n                if (this.box.intersects(searchArea)) {\r\n                    for (let i = 0; i < this.children.length; i++) {\r\n                        this.children[i].search(searchArea, hits);\r\n                    }\r\n                } else {\r\n                    return;\r\n                }\r\n            }   \r\n        }\r\n        \r\n        public add(body: Body): RTreeNode {\r\n            if (this.isLeaf) {\r\n                return null;\r\n            } else {\r\n                let result: RTreeNode = null;\r\n                \r\n                // First try adding it to my children\r\n                for (let i = 0; i < this.children.length; i++) {\r\n                    result = this.children[i].add(body);\r\n                    if (result != null) {\r\n                        return result;\r\n                    }\r\n                }\r\n                \r\n                // Otherwise check if i can take it\r\n                if (this.box.contains(body.getBoundingBox())) {\r\n                    // I can take it.\r\n                    result = new RTreeNode(body.getBoundingBox(), true);\r\n                    result.body = body;\r\n                    \r\n                    this.children.push(result);\r\n                    return result;\r\n                } else {\r\n                    // Neither my kids nor I can take it.\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}